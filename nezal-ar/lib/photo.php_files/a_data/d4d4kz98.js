/*
HTTP Host: static.ak.fbcdn.net
Generated: September 21st 2010 8:34:53 AM PDT
Machine: 10.30.147.193
Locale: nu_ll
Path: js/cgpsuh2e6zkk0wow.pkg.js
*/

((location=='about:blank'&&(window.parent.eval_global||window.parent.eval))||(window.eval_global||window.eval))("if (window.CavalryLogger) { CavalryLogger.start_js([\"js\\\/cgpsuh2e6zkk0wow.pkg.js\"]); }\n\n_PERSISTENT_BACKENDS={localstorage:LocalStorage};function LocalStorage(){this._store=window.localStorage;}LocalStorage.available=function(){return window.localStorage?true:false;};copy_properties(LocalStorage.prototype,{keys:function(){var b=[];for(var a=0;a<this._store.length;a++)b.push(this._store.key(a));return b;},get:function(a){return this._store.getItem(a);},set:function(a,b){this._store.setItem(a,b);},remove:function(a){this._store.removeItem(a);},clear:function(){this._store.clear();}});function CacheStorage(d,b){this._key_prefix=b||'_cs_';this._magic_prefix='_@_';if(d=='AUTO')for(var c in _PERSISTENT_BACKENDS){var a=_PERSISTENT_BACKENDS[c];if(a.available()){d=c;break;}}if(d)if(!_PERSISTENT_BACKENDS[d]){this._backend=null;}else this._backend=new _PERSISTENT_BACKENDS[d]();this._memcache={};}copy_properties(CacheStorage.prototype,{keys:function(){var d=[];if(this._backend){var a=this._backend.keys();for(var b=0;b<a.length;b++)if(a[b].substr(0,this._key_prefix.length)==this._key_prefix)d.push(a[b].substr(this._key_prefix.length));return d;}for(var c in this._memcache)d.push(c);return d;},set:function(b,a){this._memcache[b]=a;if(this._backend){if(typeof a=='string'){a=this._magic_prefix+a;}else a=JSON.encode(a);this._backend.set(this._key_prefix+b,a);}},get:function(b,c){if(this._memcache[b]!==undefined)return this._memcache[b];var d=undefined;if(this._backend){var d=this._backend.get(this._key_prefix+b);if(d!==null){if(d.substr(0,this._magic_prefix.length)==this._magic_prefix){d=d.substr(this._magic_prefix.length);}else d=JSON.decode(d);this._memcache[b]=d;}else d=undefined;}if(d===undefined&&c!==undefined){d=c;this._memcache[b]=d;if(this._backend){if(typeof d=='string'){var a=this._magic_prefix+d;}else var a=JSON.encode(d);this._backend.set(this._key_prefix+b,a);}}return d;},remove:function(a){delete this._memcache[a];if(this._backend)this._backend.remove(this._key_prefix+a);}});\nfunction Nectar(){}copy_properties(Nectar,{linkHandler:function(d,b){var c=Nectar.getNectarParams();c.ia=1;var f=b.href;if(!f){f=URI.getRequestURI().toString();c.err=1;}c.url=f;var a=b.async_url||'\/ajax\/nectar.php';var e=URI(a).addQueryData({nctr:c}).toString();e+='&';new AsyncSignal(e,{}).send();return d;},getNectarParams:function(){var a={};copy_properties(a,Nectar.extraData.get_query_data());return a;},extraData:function(){var a={};var b=[];return {set_item:function(c,e,d){var f=a[c];if(f===undefined){if(d)b.push(c);f=[];a[c]=f;}return f.push(e);},get_item:function(c){return a[c]||[];},get_query_data:function(){var c,f,d,e={};for(c=0;c<b.length;c++){d=b[c];f=a[d];if(f)e[d]=f.join(',');}if('pts' in a)e.num_pts=a.pts.length;a=[];b=[];return e;}};}()});\nfunction NectarPhotosLog(){}copy_properties(NectarPhotosLog,{PHOTOS_BUF_LEN:20,showPhotoHandler:function(f,a){if(a.flush)NectarPhotosLog.flushLog();var b=a.node;var e=a.pid;var c=a.owner_id;var d=Nectar.extraData.get_item('pts');if(e!==undefined){if(d.length==0)Nectar.extraData.set_item('url',b.href,false);Nectar.extraData.set_item('pts',c+':'+e,true);}d=Nectar.extraData.get_item('pts');if(d.length>=NectarPhotosLog.PHOTOS_BUF_LEN)NectarPhotosLog.flushLog();return false;},flushLog:function(){var a=Nectar.extraData.get_item('pts');if(a.length>0){var b=Nectar.extraData.get_item('url')[0];Nectar.linkHandler(false,{href:b,async_url:'\/ajax\/nectar_photos.php'});}return false;}});onloadRegister(function(){Arbiter.subscribe('photostream\/showPhoto',NectarPhotosLog.showPhotoHandler);});onbeforeunloadRegister(function(){NectarPhotosLog.flushLog();},false);\nfunction PageCache(a,b){if(this===window)return new PageCache(a,b);this._MAX_PAGE_NUM=typeof a=='undefined'?5:a;this._MAX_TTL=typeof b=='undefined'?600000:b;this._storage=new CacheStorage();}copy_properties(PageCache.prototype,{_normalizeURI:function(a){a=new URI(a);if(a.getPath()=='\/')a.setPath('\/home.php');return a.getUnqualifiedURI().setFragment('').removeQueryData('ref').toString();},addPage:function(c,b){c=this._normalizeURI(c);var a=this._storage.get(c,{});a.normalized_uri=new URI(c);copy_properties(a,b);a.accessTime=a.genTime=(new Date()).getTime();this._clearCache();},updatePage:function(c,a){c=this._normalizeURI(c);var b=this._storage.get(c);if(typeof b==='undefined')return;copy_properties(b,a);this._storage.set(c,b);},isPageInCache:function(b){var a=this._storage.get(this._normalizeURI(b));return (typeof a!=='undefined');},invalidatePage:function(a){a=this._normalizeURI(a);this._storage.remove(a);},getPage:function(b){this._clearCache();b=this._normalizeURI(b);var a=this._storage.get(b);if(typeof a==='undefined')return null;a.accessTime=(new Date()).getTime();return a;},getPageUris:function(){return this._storage.keys();},_clearCache:function(){var b=(new Date()).getTime();var d=null;var f=0;var a=this._storage.keys();for(var c=0;c<a.length;c++){var h=a[c];var e=this._storage.get(h);var g=e.ttl||this._MAX_TTL;if(e.genTime<b-g){this._storage.remove(h);continue;}if(!d||this._storage.get(d).accessTime>e.accessTime)d=h;f++;}if(f>this._MAX_PAGE_NUM&&d)this._storage.remove(d);}});\nvar Quickling=window.Quickling||{isActive:function(){return Quickling._is_active||false;},isFeatureEnabled:function(a){return Quickling._capabilities&&Quickling._capabilities[a];},init:function(c,b,a){if(Quickling._is_initialized)return;copy_properties(Quickling,{_is_initialized:true,_is_active:true,_session_length:b,_capabilities:a,_is_in_transition:false,_title_interval:false,_ie_cache_title:'',_cache_hit:false,_version:c});Quickling._instrumentTimeoutFunc('setInterval');Quickling._instrumentTimeoutFunc('setTimeout');PageTransitions.registerHandler(Quickling._transitionHandler,1);if(Quickling.isFeatureEnabled('page_cache')){Quickling._cache=new PageCache();Quickling._invalidate_msgs=[];Arbiter.subscribe(\"pre_page_transition\",Quickling._onPrePageTransition);Arbiter.subscribe(Arbiter.NEW_NOTIFICATIONS,Quickling._onNotifications);Arbiter.subscribe(AsyncRequest.REPLAYABLE_AJAX,Quickling._onReplayableAjax);Arbiter.subscribe(Arbiter.PAGECACHE_INVALIDATE,Quickling._onCacheInvalidates);}},_onPrePageTransition:function(b,a){if(Quickling.isFeatureEnabled('page_cache')&&(page=Quickling._cache.getPage(a.from))&&!page.incremental_updates){invoke_callbacks(page.onpagecache);page.refresh_pagelets.forEach(function(c){var d=Quickling._getPageletById(c);d&&d.refresh(true);});page.incremental_updates=AsyncRequest.stashBundledRequest();}},_onNotifications:function(b,a){Quickling._cache=new PageCache();Quickling._invalidate_msgs=[];},_onCacheInvalidates:function(c,b){if(Quickling.isFeatureEnabled('page_cache')&&b&&b.length){for(var a=0;a<b.length;a++)if(parseInt(b[a])===0){if(Quickling._is_in_transition&&!Quickling.isFeatureEnabled('flush_cache_in_transition'))break;if(Quickling._cache.isPageInCache(PageTransitions.getMostRecentURI())&&!Quickling.isFeatureEnabled('flush_cache_in_page_write'))break;Quickling._cache=new PageCache();Quickling._invalidate_msgs=[];return;}Quickling._invalidate_msgs=Quickling._invalidate_msgs.concat(b);}},_refresh_pagelets:function(){if(is_empty(window.__listeners))return;for(var a=0;a<Quickling._invalidate_msgs.length;a++){var b=Quickling._invalidate_msgs[a];if(b in window.__listeners)window.__listeners[b].forEach(function(c){c.refresh();});}},registerPageCacheHook:function(a,c){if(!Quickling._is_initialized||!Quickling._is_active||Quickling._is_in_transition||!Quickling.isFeatureEnabled('page_cache'))return;var b=PageTransitions.getMostRecentURI();var e=Quickling._cache.getPage(b);if(e){if(c)for(var d=0;d<e.replays.length;d++)if(e.replays[d][0]==c){e.replays.splice(d,1);d--;}e.replays.push([c,a]);}},_onReplayableAjax:function(c,b){if((PageTransitions.getNextURI().toString()!=PageTransitions.getMostRecentURI().toString()))return;if(Quickling._is_in_transition)return;var a=Quickling._whitelist_regex;if(!a)a=Quickling._whitelist_regex=new RegExp(env_get('pagecache_whitelist_regex'));if(a.test(URI(b.getURI()).getPath()))return;Quickling.registerPageCacheHook(bind(b,b.replayResponses),b._replayKey);},_startQuicklingTransition:function(){Quickling._is_in_transition=true;window.channelManager&&window.channelManager.setActionRequest(true);},_stopQuicklingTransition:function(){(function(){Quickling._is_in_transition=false;}).defer();},isCacheHit:function(){return Quickling._cache_hit;},goHashOrGoHere:function(d){var c=URI.getRequestURI();var b=c.getFragment();if(b.startsWith('\/')){var a=b;}else var a=d;setTimeout(function(){PageTransitions.go(a,true);},0);},isPageActive:function(e){if(e=='#')return false;e=new URI(e);if(e.getDomain()&&e.getDomain()!=URI().getDomain())return false;var b=Quickling.isPageActive.regex;if(!b)b=Quickling.isPageActive.regex=new RegExp(env_get('quickling_inactive_page_regex'));if(e.getPath()=='\/l.php'){var c=e.getQueryData().u;if(c){c=URI(unescape(c)).getDomain();if(c&&c!=URI().getDomain())return false;}}var d=e.getPath();var a=e.getQueryData();if(a)d+='?'+URI.implodeQuery(a);if(b.test(d))return false;return true;},_getPageletById:function(a){return window.__UIControllerRegistry&&window.__UIControllerRegistry[a];},_setHTML:function(a,b){if(ua.ie()<=6){a.innerHTML=b;}else DOM.setContent(a,HTML(b).setDeferred(true));},_transitionHandler:function(h){AjaxPipeRequest.setCurrentRequest(null);if(Quickling._isTimeToRefresh())return false;if(!Quickling.isPageActive(h))return false;removeHook('onafterloadhooks');removeHook('onloadhooks');_runHooks('onleavehooks');window.ExitTime=(new Date()).getTime();Arbiter.inform('onload\/exit',true);Quickling._startQuicklingTransition();$('content').style.visibility=\"visible\";var e;if(Quickling.isFeatureEnabled('page_cache')&&(e=Quickling._cache.getPage(h))){var d=null;var f=(+new Date());var g=null;var a=new Arbiter();a.registerCallback(function(){if(AjaxPipeRequest.getCurrentRequest()!==d)return;if(d)if(d.cavalry){var i=null;if(g)i=g-f;d.cavalry.setTimeStamp('t_domcontent',null,null,i);d.cavalry.setTimeStamp('t_hooks',null,null,i);d.cavalry.setTimeStamp('t_layout',null,null,i);d.cavalry.setTimeStamp('t_onload',null,null,i);}Quickling._cache_hit=true;invoke_callbacks(e.onafterload);invoke_callbacks(e.onafterpagecache);Quickling._cache_hit=false;Quickling._stopQuicklingTransition();},['pagecache_update','tti_pagecache']);d=AsyncRequest.setBundledRequestProperties({stashedRequests:e.incremental_updates,callback:function(){if(d&&d.cavalry)d.cavalry&&d.cavalry.setTimeStamp('t_html');a.inform('pagecache_update',true,Arbiter.BEHAVIOR_EVENT);},onInitialResponse:function(j){var i=j.getPayload();if(i.redirect&&i.force){return false;}else return true;},extra_data:{uri:e.normalized_uri.getQualifiedURI().toString(),version:Quickling._version},start_immediately:true});var c=$('content');c.style.visibility=\"hidden\";AjaxPipeRequest.setCurrentRequest(d);AjaxPipeRequest.clearCanvas('content');Bootloader.loadResources(e.css.concat(e.js),null,true);Quickling._changePageTitle(e.title);Quickling._replaceSyndicationLinks(e.syndication_links||[]);var b=e.body_class||'';CSS.setClass(document.body,b);e.html=e.html.replace(\/<span class=[\"']?muffin_tracking_pixel_start['\"]?><\\\/span>.*?<span class=[\"']?muffin_tracking_pixel_end['\"]?><\\\/span>\/ig,'');Quickling._setHTML(c,e.html);if(c&&c.style.height=='1234px')c.style.height='';PageTransitions.transitionComplete(true);Quickling._cache_hit=true;invoke_callbacks(e.onload);Quickling._cache_hit=false;Quickling._refresh_pagelets();e.replays.forEach(function(i){i[1]();});e.refresh_pagelets.forEach(function(i){var j=document.getElementById(i);if(j)j.innerHTML='';});setTimeout(function(){PageTransitions.restoreScrollPosition();$('content').style.visibility=\"visible\";g=(+new Date());a.inform('tti_pagecache',true,Arbiter.BEHAVIOR_EVENT);},20);}else new QuickPipeRequest(h).setCanvasId('content').send();return true;},_changePageTitle:function(a){a=a||'Facebook';DocumentTitle.set(a);if(ua.ie()){Quickling._ie_cache_title=a;if(!Quickling._title_interval)Quickling._title_interval=window.setInterval(function(){var b=Quickling._ie_cache_title;var c=DocumentTitle.get();if(b!=c)DocumentTitle.set(b);},5000,false);}},_replaceSyndicationLinks:function(d){var c=document.getElementsByTagName('link');for(var b=0;b<c.length;++b){if(c[b].rel!='alternate')continue;DOM.remove(c[b]);}if(d.length){var a=DOM.find(document,'head');a&&DOM.appendContent(a,HTML(d[0]));}},cacheResponse:function(c,a){var b=c.payload;Quickling._cache.addPage(PageTransitions.getNextURI(),{title:b.title,syndication:b.syndication||[],body_class:b.body_class,html:b.content.content,js:b.js||[],css:b.css||[],onload:b.onload||[],onafterload:b.onafterload||[],refresh_pagelets:b.refresh_pagelets||[],onpagecache:b.onpagecache||[],onafterpagecache:b.onafterpagecache||[],ttl:b.page_cache_ttl,replays:[]});if(a){invoke_callbacks(b.onload);onafterloadRegister(function(){invoke_callbacks(b.onafterload);});}},cacheAndExecResponse:function(c,d){var a=PageTransitions.getNextURI();var b=Quickling._cache.getPage(a);if(b){if(c.html)b.html=c.html;b.js=b.js.concat(c.js||[]);b.css=b.css.concat(c.css||[]);b.onload=b.onload.concat(c.onload||[]);b.onafterload=b.onafterload.concat(c.onafterload||[]);b.onpagecache=b.onpagecache.concat(c.onpagecache||[]);b.onafterpagecache=b.onafterpagecache.concat(c.onafterpagecache||[]);b.refresh_pagelets=b.refresh_pagelets.concat(c.refresh_pagelets||[]);}if(!d){invoke_callbacks(c.onload);onafterloadRegister(function(){invoke_callbacks(c.onafterload);});}},_isTimeToRefresh:function(){Quickling._load_count=(Quickling._load_count||0)+1;return Quickling._load_count>=Quickling._session_length;},_instrumentTimeoutFunc:function(a){window[a+'_native']=(function(c){var b=function b(e,d){return c(e,d);};return b;})(window[a]);window[a]=function _setTimeout(d,c,b){var e=window[a+'_native'](d,c);if(c>0)if(b!==false)onleaveRegister(function(){clearInterval(e);});return e;};}};function QuickPipeRequest(b){var a={version:Quickling._version};this.parent.construct(this,b,{quickling:a});}QuickPipeRequest.extend('AjaxPipeRequest');copy_properties(QuickPipeRequest.prototype,{_preBootloadFirstResponse:function(b){var a=b.getPayload();if(Quickling.isFeatureEnabled('page_cache')&&a.page_cache_ttl)Quickling.cacheResponse(b);DOMScroll.scrollTo(new Vector2(0,0,'document'),false);return true;},_fireDomContentCallback:function(){this._request.cavalry&&this._request.cavalry.setTimeStamp('t_domcontent');Quickling._stopQuicklingTransition();PageTransitions.transitionComplete();this.parent._fireDomContentCallback();},_fireOnloadCallback:function(){if(this._request.cavalry){this._request.cavalry.setTimeStamp('t_hooks');this._request.cavalry.setTimeStamp('t_layout');this._request.cavalry.setTimeStamp('t_onload');}this.parent._fireOnloadCallback();},_redirect:function(a){if(a.redirect){if(a.force||!Quickling.isPageActive(a.redirect)){go_or_replace(window.location,URI(a.redirect).removeQueryData(['quickling','ajaxpipe']),true);}else PageTransitions.go(a.redirect,true);return true;}else return false;},_versionCheck:function(a){if(a.version!=Quickling._version){go_or_replace(window.location,URI(a.uri).removeQueryData(['quickling','ajaxpipe']),true);return false;}else return true;},_processFirstPayload:function(b){Quickling._changePageTitle(b.title);Quickling._replaceSyndicationLinks(b.syndication||[]);var a=b.body_class||'';CSS.setClass(document.body,a);if(b.hasOnbeforeshow)$('content').style.visibility='hidden';}});function onpagecacheRegister(a,b){b=(b===undefined?'':String(b));Quickling.registerPageCacheHook(a,b);}\nvar Photolike={bindKeys:function(b){var a=b||'photoinfo';KeyEventController.registerKey('L',function(){var c=DOM.scry(ge(a),\"button[name='like']\")[0];if(c)c.click();});KeyEventController.registerKey('U',function(){var c=DOM.scry(ge(a),\"button[name='unlike']\")[0];if(c)c.click();});}};\nfunction PhotoTag(a,b,d,c){copy_properties(this,{centerPoint:new Vector2(a\/100,b\/100),photoOwnerId:d,photoId:c});copy_properties(this,{taggeeName:'',taggeeId:null,taggeeEmail:'',scale:1,source:'',_saved:false,_pendingAsync:false});}copy_properties(PhotoTag,{SYNCING_ENDPOINT:'\/ajax\/photo_tagging_ajax.php',MAX_TAGS_PER_PHOTO:50,_tagList:{},_photoKey:function(a,b){return a+':'+b;},tagsForPhoto:function(a,c){var b=PhotoTag._photoKey(a,c);return PhotoTag._tagList[b]||[];},clearTagsForPhoto:function(a,c){var b=PhotoTag._photoKey(a,c);PhotoTag._tagList[b]=[];}});copy_properties(PhotoTag.prototype,{setTaggeeEmail:function(a){if(this.saved){return this;}else this.taggeeEmail=a;return this;},setTaggeeName:function(a){if(this.saved){return this;}else this.taggeeName=a;return this;},setTaggeeId:function(a){if(!(this.saved))this.taggeeId=a;return this;},absoluteCenter:function(b,a){return this.centerPoint.mul(b,a);},submit:function(b){if(!this.taggeeName&&!this.taggeeId){return;}else if(this._saved){return;}else if(this._pendingAsync){return;}else if(PhotoTag.MAX_TAGS_PER_PHOTO<=PhotoTag.tagsForPhoto(this.photoId,this.photoOwnerId).length)return;b=b||bagofholding;var a={pid:this.photoId,id:this.photoOwnerId,subject:this.taggeeId,name:this.taggeeName,email:this.taggeeEmail,action:'add',x:this.centerPoint.x*100,y:this.centerPoint.y*100,scale:this.scale,source:this.source};this._pendingAsync=true;new AsyncRequest().setURI(PhotoTag.SYNCING_ENDPOINT).setData(a).setHandler(bind(this,this._submitHandler,b)).setErrorHandler(bind(this,this._submitHandler,b)).setFinallyHandler(bind(this,function(){this._pendingAsync=false;})).send();},remove:function(c,a){if(!this.taggeeName&&!this.taggeeId){return;}else if(this._pendingAsync){return;}else if(!this._saved){this._removeLocal();return c(this,{});}c=c||bagofholding;var b={pid:this.photoId,id:this.photoOwnerId,subject:this.taggeeId,name:this.taggeeName,action:a||'remove'};this._pendingAsync=true;new AsyncRequest().setURI(PhotoTag.SYNCING_ENDPOINT).setData(b).setHandler(bind(this,this._removeHandler,c)).setFinallyHandler(bind(this,function(){this._pendingAsync=false;})).send();return false;},_removeLocal:function(){var c=PhotoTag._photoKey(this.photoId,this.photoOwnerId);var d=PhotoTag._tagList[c]||[];for(var a=0,b=d.length;a<b;a++)if(d[a]==this){d.splice(a,1);break;}},setLocalSave:function(){var b=PhotoTag._photoKey(this.photoId,this.photoOwnerId);var a=PhotoTag._tagList[b]=PhotoTag._tagList[b]||[];PhotoTag._tagList[b][a.length]=this;return this;},setSaved:function(){this._saved=true;return this.setLocalSave();},getText:function(){return this.taggeeName||this.taggeeEmail;},getTaggeeId:function(){return this.taggeeId;},setScale:function(a){this.scale=a;return this;},setSource:function(a){this.source=a;return this;},setSource:function(a){this.source=a;return this;},_submitHandler:function(a,d){var b=d.getError();var c=d.getPayload();if(b){ErrorDialog.showAsyncError(d);if(!c['tag_success'])return;}this.setSaved();this.taggeeName=c.taggeeName;this.taggeeId=c.taggeeId;a(this,c);},_removeHandler:function(a,b){this._removeLocal();(a||bagofholding)(this,b.getPayload());}});\nfunction PhotoTagBoxController(b,a){Event.listen(b,{mouseover:function(c){var e=Parent.byClass(c.getTarget(),'phototag_name');if(!e)return;var d=$(e.id.replace('tag_name','tag_box'));if(CSS.hasClass(d,'tag_box_unplaced'))Bootloader.loadComponents('photo-tag-box-positioning',function(){LegacyPhotoTagPositioner.position($('myphoto'),a);});CSS.show(d);},mouseout:function(c){$$('#photo_container span.tag_outer').each(function(d){CSS.hide(d);});}});}\n\nif (window.Bootloader) { Bootloader.done([\"js\\\/cgpsuh2e6zkk0wow.pkg.js\"]); }")